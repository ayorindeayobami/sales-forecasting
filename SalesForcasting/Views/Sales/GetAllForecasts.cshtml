@model List<SalesForcasting.Models.SalesData>

@{
    ViewData["Title"] = "Sales Forecasts";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <h2 class="text-center mb-4 text-primary fw-bold">📊 Sales Forecast (Next 7 Days)</h2>

    <!-- Table -->
    <div class="table-responsive mb-5">
        <table class="table table-striped table-hover shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Forecasted Sales</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Date.ToString("dddd, dd MMM yyyy")</td>
                        <td>$@item.Sales.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Chart -->
    <div class="card shadow-lg p-4">
        <canvas id="forecastChart" height="120"></canvas>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.Date.ToString("MM/dd/yyyy"))));
        const data = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.Sales)));

        const ctx = document.getElementById('forecastChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Forecasted Sales',
                    data: data,
                    fill: true,
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.2)',
                    tension: 0.4,
                    pointBackgroundColor: '#0d6efd',
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: { color: '#333' },
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: '7-Day Sales Forecast Trend',
                        color: '#0d6efd',
                        font: {
                            size: 20,
                            weight: 'bold'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        beginAtZero: false,
                        ticks: { callback: value => value.toLocaleString() }
                    }
                }
            }
        });
    </script>
}

